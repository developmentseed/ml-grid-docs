<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="description" content="Using ML to augment human tracing of HV infrastructure" />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

<title>Mapping the electric grid</title>

<!-- Twitter -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="" />
<meta name="twitter:title" content="Mapping the electric grid">
<meta name="twitter:description" content="Using ML to augment human tracing of HV infrastructure" />
<meta name="twitter:image:src" content="https://devseed.com/ml-grid-docs/assets/graphics/meta/default-meta-image.png" />
<!--/ Twitter -->

<!-- OG -->
<meta property="og:site_name" content="Mapping the electric grid" />
<meta property="og:title" content="Mapping the electric grid" />
<meta property="og:url" content="" />
<meta property="og:type" content="website" />
<meta property="og:description" content="Using ML to augment human tracing of HV infrastructure" />
<meta property="og:image" content="https://devseed.com/ml-grid-docs/assets/graphics/meta/default-meta-image.png" />
<!--/ OG -->

<link rel="icon" type="image/png" sizes="96x96" href="https://devseed.com/ml-grid-docs/assets/graphics/meta/favicon.png" />
<link rel="icon" type="image/png" sizes="192x192" href="https://devseed.com/ml-grid-docs/assets/graphics/meta/android-chrome.png" />
<link rel="apple-touch-icon" sizes="180x180" href="https://devseed.com/ml-grid-docs/assets/graphics/meta/apple-touch-icon.png" />


<link rel="author" type="text/plain" href="humans.txt" />

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i" />



<link rel="stylesheet" href="https://devseed.com/ml-grid-docs/assets/styles/main-0e59bd1017.css">

  </head>
  <body>
    <!-- page -->
    <div class="page">

      <header class="page__header" role="banner">
        <div class="inner">
          <div class="page__headline">
            <a href="/" title="Visit homepage">
              <h1 class="page__title">Mapping the electric grid</h1>
              <p class="page__subtitle">Using ML to augment human tracing of HV infrastructure</p>
            </a>
          </div>
          <div class="page__browser pb" data-hook="menu:wrapper">
            <h2 class="pb__title"><a href="#ppn__contents" title="Show/hide" class="pb__toggle" data-hook="menu:toggle"><span>Navigation & Colophon</span></a></h2>
            <div id="pb__contents" class="pb__contents">
              <div class="inner">
                <nav class="page__prime-nav ppn">
  
  

  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Summary</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/" title="Go to page" class="ppn__menu-item ">Executive Summary</a>
      




  </li>
  
</ul>

  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Introduction</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/introduction/problem" title="Go to page" class="ppn__menu-item ">Problem</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/introduction/strategy" title="Go to page" class="ppn__menu-item ">Strategy</a>
      




  </li>
  
</ul>

  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Methodology</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/methodology/the-processing-pipeline" title="Go to page" class="ppn__menu-item ">The processing pipeline</a>
      




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/methodology/1-download-imagery" title="Go to page" class="ppn__menu-item ">1. Download imagery</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/methodology/2-machine-learning" title="Go to page" class="ppn__menu-item ">2. Machine learning</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/methodology/3-ml-derived-overlay" title="Go to page" class="ppn__menu-item ">3. ML-derived overlay</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/methodology/4-tracing" title="Go to page" class="ppn__menu-item ">4. Tracing</a>
      




  </li>
  
</ul>

  </li>
  
</ul>

  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Results</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/results/optimization-model-training" title="Go to page" class="ppn__menu-item ">Optimization: model training</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/results/optimization-signal-detection-threshold" title="Go to page" class="ppn__menu-item ">Optimization: signal detection threshold</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/results/country-wide-predictions" title="Go to page" class="ppn__menu-item ">Country-wide predictions</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/results/mapping-output-and-speed" title="Go to page" class="ppn__menu-item ">Mapping output and speed</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/results/compute-costs" title="Go to page" class="ppn__menu-item ">Compute costs</a>
      




  </li>
  
</ul>

  </section>
  
  <section class="ppn__section">
    <h3 class="ppn__section-title">Discussion</h3>
    




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/discussion/discussion" title="Go to page" class="ppn__menu-item ">Discussion</a>
      




<ul class="ppn__menu">
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/discussion/1-big-data" title="Go to page" class="ppn__menu-item ppn__menu-item--active">1. Big data</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/discussion/2-improving-ml-output" title="Go to page" class="ppn__menu-item ">2. Improving ML output</a>
      




  </li>
  
  <li>
      
      <a href="https://devseed.com/ml-grid-docs/discussion/3-improving-mapping-workflow" title="Go to page" class="ppn__menu-item ">3. Improving mapping workflow</a>
      




  </li>
  
</ul>

  </li>
  
</ul>

  </section>
  
</nav>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="page__body" role="main">
        <div class="inner">

          
          <!-- attribution -->
          <address class="page__attribution pa">
            <div class="pa__label">
              <small>Developed for World Bank</small>
              <a href="https://github.com/developmentseed/ui-seed/" title="Visit">
                <strong>World Bank Group</strong>
              </a>
            </div>
            
            <div class="pa__logo">
              <a href="https://github.com/developmentseed/ui-seed/" title="Visit">
                <img alt="World Bank Group logo" src="https://devseed.com/ml-grid-docs/assets/graphics/content/credits/wbg-logo-hor-col-grad.png" />
              </a>
            </div>
            
          </address>
          <!--/ attribution -->
          

          <!-- inpage -->
          <article class="inpage">
            <header class="inpage__header">
              <div class="inner">
                
                <div class="inpage__headline">
                  <p class="inpage__subtitle">Discussion</p>
                  <h1 class="inpage__title">1. Big data</h1>
                </div>

              </div>
            </header>

            <div class="inpage__body">
              <div class="inner">
                <div class="prose prose--responsive">
                  <h3>Downloading large datasets</h3>
<p>Perhaps the biggest challenge in this project was handling the tens of millions of images for each country. HV towers only become recognizable at about zoom 18 imagery (~0.5 meter/pixel resolution), which is a relatively high spatial resolution for commercially available satellite imagery. The cost associated with this high spatial resolution is that we were forced to handle a very large volume of tiles. Just the act of downloading the imagery from the <a href="https://platform.digitalglobe.com/maps-api/">Digital Globe Maps API</a> was extremely computationally intensive. We ran tens of thousands of networking coroutines -- essentially lightweight threads each downloading a single image at a time -- in parallel. This was the only method we found to obtain the country-wide image sets in a reasonable amount of time. It also required us to keep track of which files had been downloaded to avoid wasting time and resources; at nearly a hundred million image tiles, tracking this process is no longer trivial. Standard operating systems will throw an error if you simply try to list or delete a folder with this many files.</p>
<p>For the next iteration, we will likely use AWS's Simple Queue Service (SQS) to tabulate all tiles that need downloading. Each entry will contain tile indices, which our downloading script can pull from asynchronously. Then, each entry in the queue is only removed if our downloading process sends back confirmation that it worked correctly. This should provide a fault tolerant and more efficient solution that could also scale if we needed to process more countries. It will also allow us to more easily download a portion of the total images. In many cases, the ML algorithm does not need to predict the entire country's images for the strings of HV towers to become visible to a human in an ML-generated map overlay. In the first iteration, the download script randomly skipped over images with a probability dependent on the desired download proportion (i.e., if we only wanted half of a country's images, we would set this skip probability to 0.5). Using SQS, we can randomly shuffle the queue once and then download the desired number of images directly instead of wasting computation in this skip procedure.</p>
<h3>Optimizing download and prediction speed</h3>
<p>We also decided to download all imagery directly to AWS S3 for storage. This choice was useful in that we never had to request any imagery twice from the Digital Globe Maps API, and we had a full copy of all the data we intended to process. We also believed it was possible to rapidly transfer images from S3 to EC2 instances for the inference stage, which was dependent on GPU instances that are charged by the length of time that they're reserved.</p>
<p>However, the storing and accessing data on S3 was both costly and slow. There are set financial costs associated with the raw volume of stored data as well as costs for each file uploaded or downloaded to and from S3. But accessing stored data was more expensive than expected simply because of the sheer number of files that we were required to process. Additionally, the speed at which we could access stored data was much slower than expected. This likely occurred for two reasons: First, since S3 accesses files using a key-based system, any request for a subset of imagery (using asterisk wild cards for example) required the AWS servers to iterate over all keys to find the relevant subset; again, because of the large volume of files, this was surprisingly slow — in some cases, an S3 copy request could take 1-2 hours before the download even started. Second, the effective download speed (in Mbps) was also quite slow. We found there is a fixed overhead computational cost to initiating the download of a single file. As an practical example, this means that downloading one-thousand 1kb files is much slower than downloading one 1 Mb file. We found that transferring data from S3 to EC2 instances (for inference) was about 100x slower than AWS is capable of had the same data been stored as a single file.</p>
<p>Future efforts should attempt to avoid S3 and focus on methods of downloading imagery directly to EC2 instances immediately before prediction. The challenge here is to match the speed that images are downloaded with the speed of prediction. Currently, the download step is 2-5x slower depending on the GPU instance used for prediction. Download speed could be increased by finding a better method of requesting images (currently done via HTTP). It may also be possible to somehow construct super-images each made up of 25 or 100 individual tiles (in 5x5 or 10x10 squares, respectively) prior to downloading them. This would address some of those constant overhead and possibly reduce the effective per-image download time. Even something as simple as combining large groups of images into single zip files might help reduce the slowdowns we experienced.</p>

                </div>
              </div>
            </div>

            <footer class="inpage__footer">
              <div class="inner">
                <nav class="inpage__actions">
                  <ul>
                    <li>
                      
                        <a href="https://devseed.com/ml-grid-docs/discussion/discussion" class="pa-prev" title="View previous post"><span>Prev</span></a>
                      
                    </li>
                    <li>
                      
                        <a href="https://devseed.com/ml-grid-docs/discussion/2-improving-ml-output" class="pa-next" title="View next post"><span>Next</span></a>
                      
                    </li>
                  </ul>
                </nav>
              </div>
            </footer>
          </article>
          <!--/ inpage -->

        </div>
      </main>

      <footer class="page__footer" role="contentinfo">
        <div class="inner">
          <p>
            <a href="https://developmentseed.org" title="Visit Development Seed website">
              <span><img src="https://devseed.com/ml-grid-docs/assets/graphics/layout/devseed-logo-symbol.svg" alt="Development Seed logo symbol" width="512" height="152" /></span>
              <strong>Development Seed</strong>
              <small>2018</small>
            </a>
          </p>
        </div>
      </footer>

    </div>
    <!--/ page -->

    <script src="https://devseed.com/ml-grid-docs/assets/scripts/vendor-d4a1581659.js"></script>

<script src="https://devseed.com/ml-grid-docs/assets/scripts/bundle-5ac9a1fb1b.js"></script>
  </body>
</html>